---
description: Context compiler - intake task, ask questions, create YAML capsule for handoff
argument-hint: <task-description>
---

# /phase0 - The Context Compiler

**Purpose**: Intake a task, understand it deeply, create a machine-readable capsule that other plugins can consume.

**Philosophy**: "Don't make me re-explain everything" - capsules persist context across sessions.

---

## Input

Task description: $ARGUMENTS

---

## Phase 1: Read Context (if exists)

```bash
# Check for existing context files
[ -f "patterns.yaml" ] && echo "patterns.yaml: found" || echo "patterns.yaml: not found"
[ -f "ARCHITECTURE.md" ] && echo "ARCHITECTURE.md: found" || echo "ARCHITECTURE.md: not found"
ls -la /.phase0/capsules/ 2>/dev/null | head -5 || echo "No existing capsules"
```

If patterns.yaml exists, read and summarize key constraints.
If ARCHITECTURE.md exists, note its age and compliance status.

---

## Phase 2: Restatement

Restate the task in Claude's words:

```
## My Understanding

[Restate what the user is asking for in 2-3 sentences]

**Goal**: [One sentence goal]
**Success looks like**: [Concrete outcome]
**This is NOT**: [What we're explicitly avoiding]
```

Wait for user confirmation before proceeding.

---

## Phase 3: Clarifying Questions

Use AskUserQuestion to gather essential details. Ask 2-4 questions max:

**Typical questions**:
1. Scope: Full-stack / API-only / Frontend-only / Other?
2. Testing: Unit only / Unit + Integration / Full coverage?
3. Integration: New feature / Extends existing / Replaces existing?
4. Priority: What's the most important aspect?

Store answers for capsule.

---

## Phase 4: Context Scanning (Internal Agents)

Launch scanning in background (internal, not exposed):

1. **File scan**: Find files related to task keywords
2. **Import trace**: Map dependencies in relevant area
3. **Pattern check**: Compare against patterns.yaml rules
4. **Boundary check**: Identify any layer violations

Synthesize findings into:
- Critical files to read
- Conventions to follow
- Risks identified
- Integration points

---

## Phase 5: Create Capsule

Create `/.phase0/capsules/<slug>/capsule.yaml`:

```yaml
# Auto-generated by /phase0 - DO NOT EDIT MANUALLY
version: "1.0"
created: "YYYY-MM-DDTHH:MM:SSZ"
slug: "<task-slug>"

goal: |
  [Claude's restatement of the goal]

non_goals:
  - [What we're NOT doing]
  - [Explicit scope boundaries]

constraints:
  - [From patterns.yaml if applicable]
  - [From user answers]
  - [Technical constraints discovered]

success_criteria:
  - tests_pass: true
  - files_created:
      - [expected file 1]
      - [expected file 2]
  - no_regressions: true

context:
  patterns_path: "patterns.yaml"  # or null
  architecture_path: "ARCHITECTURE.md"  # or null
  key_files:
    - path: "[critical file 1]"
      reason: "[why it matters]"
    - path: "[critical file 2]"
      reason: "[why it matters]"

questions:
  decisions_made:
    - question: "[question asked]"
      answer: "[user's answer]"
  open_questions: []

handoff:
  recommended_command: "/dev-flow"  # or /bug-hunt
  args: "--capsule <slug>"
  reasoning: "[why this command]"

risks:
  - severity: "high|medium|low"
    description: "[risk description]"
    mitigation: "[how to handle]"
```

Ensure directory exists:
```bash
mkdir -p /.phase0/capsules/<slug>
```

---

## Phase 6: Handoff

Present capsule summary and recommend next step:

```
## Capsule Created

/.phase0/capsules/<slug>/capsule.yaml

SUMMARY
├── Goal: [brief]
├── Success criteria: [count] items
├── Key files: [count] identified
├── Risks: [count] ([high count] high)
└── Ready for: [recommended command]

NEXT STEP
Run: [recommended_command] --capsule <slug>

[Or ask questions if anything is unclear]
```

---

## Writes (ONLY these locations)

- `/.phase0/capsules/<slug>/capsule.yaml` (main output)
- `/.phase0/capsules/<slug>/notes.md` (optional, if complex)

**NEVER writes to**: `_templates/`, `patterns.yaml`, `ARCHITECTURE.md`, source code

---

## Cost

| Phase | Model | Estimated Cost |
|-------|-------|----------------|
| Scanning | Haiku×4 | ~$0.02 |
| Synthesis | Opus | ~$0.03 |
| **Total** | | **~$0.05** |
