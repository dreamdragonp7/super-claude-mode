# Phase 0 Plugin v3.0

Pre-flight exploration, pattern enforcement, and context management for Super Claude Mode.

**v3.0 introduces the Two-File System**: `patterns.yaml` (THE IDEAL) + `ARCHITECTURE.md` (THE REALITY).

## What Is Phase 0?

Phase 0 is a **required first step** before running `/dev-flow` or `/bug-hunt`. It ensures context is mapped, patterns are checked, and work is captured before diving into implementation.

## The Two-File System

| File | Purpose | Updated By |
|------|---------|------------|
| `patterns.yaml` | THE IDEAL - how your codebase SHOULD look | You (via `/planning`) |
| `ARCHITECTURE.md` | THE REALITY - what actually exists | Auto-generated by `/audit` |

**The gap between them is your work.**

## Why Phase 0?

| Problem | Solution |
|---------|----------|
| Context drift after compaction | Task capsules persist across sessions |
| Phases get skipped | Hooks enforce running phase0 first |
| Token waste on scanning | Haiku agents are 10x cheaper |
| Wrong assumptions | Scanning finds what exists before building |
| Codebase drift from patterns | `/audit` checks compliance |
| Missing boilerplate files | `/audit fix` auto-generates via Hygen |

## Commands

| Command | Purpose | Cost |
|---------|---------|------|
| `/phase0 [task]` | Full pre-flight with task capsule + scaffolding | ~$0.08 |
| `/planning` | View patterns.yaml status | ~$0.01 |
| `/planning sync` | Interactive pattern discovery with CLI questions | ~$0.05 |
| `/planning add [type]` | Add new pattern to patterns.yaml | ~$0.02 |
| `/audit` | Generate ARCHITECTURE.md snapshot | ~$0.03 |
| `/audit fix` | Auto-fix pattern gaps via Hygen | FREE |
| `/audit inventory` | Detailed codebase census | ~$0.02 |
| `/audit templates` | Show available Hygen templates | FREE |
| `/focus [topic]` | Quick context mapping | ~$0.02 |
| `/atlas` | Generate/update repo documentation | ~$0.05 |

## Agents

| Agent | Model | Purpose |
|-------|-------|---------|
| file-scanner | Haiku | CHEAP file finding |
| import-tracer | Haiku | CHEAP dependency tracing |
| test-finder | Haiku | CHEAP test discovery |
| pattern-checker | Haiku | CHEAP component pattern scanning |
| boundary-validator | Haiku | CHEAP import boundary checking |
| context-synthesizer | Opus | Smart analysis + task capsule writing |

## Skills

| Skill | Purpose |
|-------|---------|
| phase0-guide | v3.0 workflow and two-file system |
| patterns-yaml | patterns.yaml structure reference |
| ultra-scientist | 2M IQ personality mode |
| repo-atlas | Documentation system knowledge |
| task-capsules | Capsule format and lifecycle |

## Hooks

| Event | Action |
|-------|--------|
| SessionStart | Shows patterns.yaml + ARCHITECTURE.md status |
| UserPromptSubmit | Warns if no recent capsule before /dev-flow |
| PostToolUse | Warns if component created without test file |
| PreCompact | Saves session context to dev-journal.md |
| Stop | Warns about unchecked DoD items |

All hooks are **warnings only** - they don't block execution.

## The v3.0 Workflow

```
User Request
     │
     ▼
┌─────────────────────────────────────────┐
│              /phase0                     │
│                                          │
│ 1. Read patterns.yaml (THE IDEAL)        │
│ 2. Read ARCHITECTURE.md (THE REALITY)    │
│ 3. Restate task + CLI questions          │
│ 4. Haiku scan (cheap discovery)          │
│ 5. Opus synth (smart analysis)           │
│ 6. Generate boilerplate (Hygen)          │
│ 7. Create task capsule                   │
│ 8. Get approval                          │
└─────────────────────────────────────────┘
     │
     ▼ (approved)
     │
┌─────────────────┐
│  /dev-flow OR   │ ← NOW HAS CONTEXT + SCAFFOLDING
│  /bug-hunt      │
└─────────────────┘
```

## patterns.yaml Structure

```yaml
version: "3.0"
project: "your-project"

# Key files that define project contracts
source_of_truth:
  - path: "core/features/schema.py"
    purpose: "Feature vector definition"

# Layer dependency rules
boundaries:
  python:
    core:
      allow_from: []
      deny_from: [apps, infrastructure]

# What files each component type needs
component_patterns:
  react_component:
    location: "apps/web/src/components/**/"
    required_files: ["*.tsx", "index.ts", "*.test.tsx"]
    hygen_template: "component/new"

# Code smells to detect
anti_patterns:
  console-log:
    pattern: "console\\.log"
    severity: warning
```

## Installation

This plugin is part of the super-claude-mode marketplace.

```bash
# Already installed if you have super-claude-mode
# Restart Claude Code to load v3.0
```

## Usage

```bash
# Start with phase0 (includes scaffolding now)
/phase0 Add user authentication with OAuth

# View patterns.yaml status
/planning

# Interactive pattern discovery
/planning sync

# Generate ARCHITECTURE.md snapshot
/audit

# Auto-fix pattern gaps
/audit fix

# Quick context mapping
/focus authentication

# Update documentation
/atlas
```

## Philosophy

"Don't make the model remember the repo—make the repo tell the model."

- **patterns.yaml** = THE IDEAL (what you want)
- **ARCHITECTURE.md** = THE REALITY (what exists)
- **The gap** = YOUR WORK

Files persist. Memory doesn't. Externalize everything.

## Tools Integration

The plugin works with industry-standard tools:

| Tool | Purpose | Install |
|------|---------|---------|
| import-linter | Python boundary enforcement | `pip install import-linter` |
| eslint-plugin-boundaries | TypeScript boundaries | `npm i -D eslint-plugin-boundaries` |
| Hygen | Scaffolding templates | `npm i -g hygen` |

## Cross-Plugin Integration

All Super Claude Mode plugins now read patterns.yaml:

| Plugin | How It Uses patterns.yaml |
|--------|---------------------------|
| phase0 | Reads ideal, generates ARCHITECTURE.md |
| dev-flow | Verifies compliance before building |
| bug-hunt | Checks patterns during debugging |
| pr-review | Enforces patterns in reviews |

## Changelog

### v3.0.0 (2025-01-02)

- **Two-File System**: patterns.yaml (ideal) + ARCHITECTURE.md (reality)
- **Command restructuring**: Merged /scaffold→/phase0, /conform→/audit fix, /inventory→/audit inventory
- **New /planning command**: Interactive patterns.yaml management
- **5 Active hooks**: SessionStart, UserPromptSubmit, PostToolUse, PreCompact, Stop
- **Real tool integration**: import-linter, eslint-plugin-boundaries
- **Cross-plugin**: dev-flow, bug-hunt, pr-review all read patterns.yaml
- **Hygen templates**: component/test, component/index, api/schema
