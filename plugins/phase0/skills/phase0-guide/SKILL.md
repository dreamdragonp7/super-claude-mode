---
name: phase0-guide
description: Complete guide to the Phase 0 v3.0 workflow. Explains the two-file system (patterns.yaml + ARCHITECTURE.md) and how phase0 works.
---

# Phase 0 Guide (v3.0)

## What Is Phase 0?

Phase 0 is a **pre-flight exploration** step that runs before /dev-flow or /bug-hunt. It ensures context is mapped and captured before diving into implementation.

**v3.0 introduces the Two-File System**: patterns.yaml (THE IDEAL) + ARCHITECTURE.md (THE REALITY).

## The Two-File System

### patterns.yaml (THE IDEAL)

The single source of truth for how your codebase SHOULD look:

```yaml
# What you WANT the codebase to be
boundaries:
  python:
    core:
      allow_from: []
      deny_from: [apps, infrastructure]

component_patterns:
  react_component:
    location: "apps/web/src/components/**/"
    required_files: ["*.tsx", "index.ts", "*.test.tsx"]

anti_patterns:
  console-log:
    pattern: "console\\.log"
    severity: warning
```

### ARCHITECTURE.md (THE REALITY)

Auto-generated by `/audit`, shows what ACTUALLY exists:

```markdown
# Architecture Snapshot
Generated: 2025-01-02

## Pattern Compliance
- react_component: 45/52 compliant (87%)
- api_endpoint: 8/8 compliant (100%)

## Boundary Violations
- 3 Python layer violations
- 0 TypeScript boundary violations
```

### The Gap = Your Work

```
patterns.yaml     ARCHITECTURE.md
(THE IDEAL)   -   (THE REALITY)   =   THE GAP
     ↓                  ↓                ↓
  What you         What you          What you
  WANT             HAVE              FIX
```

## Why Phase 0 Exists

### The Problems It Solves

| Problem | How Phase 0 Helps |
|---------|-------------------|
| Context drift | Task capsules persist across sessions |
| Pattern violations | patterns.yaml defines expectations |
| Token waste | Haiku scanners are cheap (~$0.02) |
| Wrong assumptions | Scanning finds what exists before building |
| Lost decisions | Capsules document the plan and risks |
| Architectural drift | ARCHITECTURE.md tracks reality |

### The Philosophy

"Don't make the model remember the repo—make the repo tell the model."

## The v3.0 Workflow

```
User Request
     │
     ▼
┌─────────────────────────────────────────┐
│              /phase0                     │
│                                          │
│ 1. Read patterns.yaml (THE IDEAL)        │
│ 2. Read ARCHITECTURE.md (THE REALITY)    │
│ 3. Restate task                          │
│ 4. CLI questions (AskUserQuestion)       │
│ 5. Haiku scan (cheap discovery)          │
│ 6. Opus synth (smart analysis)           │
│ 7. Generate boilerplate (Hygen)          │
│ 8. Create task capsule                   │
│ 9. Get approval                          │
└─────────────────────────────────────────┘
     │
     ▼ (approved)
     │
┌─────────────────┐
│  /dev-flow OR   │ ← NOW HAS CONTEXT + SCAFFOLDING
│  /bug-hunt      │
└─────────────────┘
```

## Cost Optimization

| Agent | Model | Cost | Purpose |
|-------|-------|------|---------|
| file-scanner | Haiku | ~$0.005 | File finding |
| import-tracer | Haiku | ~$0.005 | Dependency chains |
| test-finder | Haiku | ~$0.005 | Test discovery |
| pattern-checker | Haiku | ~$0.005 | Pattern compliance |
| boundary-validator | Haiku | ~$0.005 | Boundary checking |
| context-synthesizer | Opus | ~$0.05 | Smart analysis |

**Total Phase 0 cost**: ~$0.08
**Without optimization**: ~$0.50+

Haiku does mechanical work. Opus does thinking.

## Commands

| Command | Purpose |
|---------|---------|
| `/phase0 [task]` | Full pre-flight with capsule + scaffolding |
| `/planning` | View patterns.yaml status |
| `/planning sync` | Interactive pattern discovery |
| `/planning add [type]` | Add new pattern |
| `/audit` | Generate ARCHITECTURE.md snapshot |
| `/audit fix` | Auto-fix pattern gaps via Hygen |
| `/audit inventory` | Detailed codebase census |
| `/focus [topic]` | Quick context mapping |
| `/atlas` | Generate repo documentation |

## Integration with Existing Workflows

Phase 0 is the **entry point** to:
- `/dev-flow` - 12-phase feature development
- `/bug-hunt` - 7-phase debugging
- `/pr-review` - PR review with pattern enforcement

All plugins now read patterns.yaml for consistency.

## When to Skip Phase 0

You can skip phase0 for:
- Trivial changes (typos, one-line fixes)
- Continuing work with existing capsule
- Pure research/exploration

But for any significant work: **run phase0 first**.
